# ServiceMaster 使用指南

## 目录
- [快速开始](#快速开始)
- [创建服务](#创建服务)
- [管理服务](#管理服务)
- [配置说明](#配置说明)
- [常见问题](#常见问题)

---

## 快速开始

### 安装

1. 从 [GitHub Releases](https://github.com/ahao430/mac-service-master/releases) 下载最新版本
2. macOS 用户首次安装可能遇到"文件已损坏"提示，执行以下命令：
   ```bash
   sudo xattr -rd com.apple.quarantine /Applications/ServiceMaster.app
   ```
3. 打开应用即可使用

### 界面概览

应用主界面包含：
- **工具栏**：新建服务、刷新列表、设置按钮
- **服务列表**：显示所有已配置的服务，支持拖拽排序
- **服务卡片**：显示服务状态、操作按钮

---

## 创建服务

### 使用预设模板（推荐）

1. 点击"新建服务"按钮
2. 在弹出的窗口中选择预设模板：
   - **CLIProxy**: CLI 代理服务
   - **OpenWebUI**: 开源 AI 对话界面
   - **AntigravityTools**: Antigravity 开发工具
3. 系统会自动填充配置
4. 根据需要调整配置
5. 点击"保存"

### 手动创建服务

#### 1. 填写基本信息

**标识符**（必填）
- 格式：`com.company.service` 或 `com.user.myapp`
- 示例：`com.user.mysql`
- 用途：launchd 服务的唯一标识符

**启动方式**（二选一）

##### 方式一：启动命令
适用于命令行程序、脚本等

- 示例：`open-webui serve`
- 示例：`/usr/local/bin/redis-server`
- 示例：`npm run start`

##### 方式二：启动应用
适用于 macOS 应用程序

- 填写应用名称：`Google Chrome`、`Visual Studio Code`
- 或填写完整路径：`/Applications/Chrome.app`
- 💡 应用模式会使用 `open -a` 命令启动

#### 2. 配置选项

**工作目录**（可选）
- 程序运行的工作目录
- 示例：`/Users/username/projects/myapp`

**标准输出日志**（可选）
- 程序输出日志的保存路径
- 示例：`/tmp/myservice.log`

**错误输出日志**（可选）
- 错误日志的保存路径
- 示例：`/tmp/myservice.err`

**开机自启动**
- ✅ 勾选后，系统启动时自动运行该服务

**崩溃自动重启**
- ✅ 勾选后，服务崩溃时自动重启

#### 3. 扩展信息

**图标**
- 选择一个图标美化服务列表显示

**显示名称**
- 服务的友好名称，显示在列表中
- 示例：`MySQL 数据库`

**端口**
- 服务监听的端口号
- 示例：`3306`、`8080`

**描述**
- 服务的简短描述

**Web 地址**
- 服务的 Web 访问地址
- 示例：`http://127.0.0.1:8080`
- 配置后可直接点击打开

**项目地址**
- 项目源码的本地路径
- 示例：`/Users/username/workspace/myproject`
- 配置后可快速打开项目文件夹

---

## 管理服务

### 启动/停止服务

在服务卡片上：
- **▶️ 播放图标**：启动服务
- **⏹️ 方块图标**：停止服务

服务状态指示：
- **绿点 + 闪烁**：服务正在运行
- **黄点**：服务已加载但未运行
- **无指示**：服务未加载

### 查看服务信息

服务卡片显示：
- **PID**：进程 ID（运行中时显示）
- **端口**：监听端口及状态（✓ 正常 / ✗ 异常 / ? 未知）
- **页面**：Web 服务健康检查状态

### 操作按钮

每个服务卡片提供以下操作：

| 图标 | 功能 | 说明 |
|------|------|------|
| 💻 | 打开应用 | 仅应用模式服务显示，点击启动应用 |
| 🌐 | 打开服务页面 | 在浏览器中打开 Web 地址 |
| 📂 | 打开项目文件夹 | 在 Finder 中打开项目目录 |
| ✏️ | 编辑 | 修改服务配置 |
| 🔄 | 重启 | 重启服务 |
| 📄 | 日志 | 查看服务日志（需配置日志路径） |

### 编辑服务

1. 点击服务卡片上的"编辑"按钮
2. 修改配置（标识符不可修改）
3. 点击"保存"

### 删除配置

1. 编辑服务
2. 点击"删除配置"按钮
3. 确认删除

⚠️ **注意**：删除配置会同时删除 launchd 配置文件

### 排序服务

- 直接拖拽服务卡片可调整顺序
- 顺序会自动保存

---

## 配置说明

### 服务配置项详解

#### 启动命令模式

系统会将命令拆分为程序和参数：
- 输入：`open-webui serve --port 8080`
- 程序：`open-webui`
- 参数：`["serve", "--port", "8080"]`

#### 启动应用模式

系统会自动转换为 `open -a` 命令：
- 输入：`Google Chrome`
- 实际执行：`open -a "Google Chrome"`

### 配置文件位置

- **launchd 配置**：`~/Library/LaunchAgents/`
- **元数据**：`~/.config/service-master/metadata.json`
- **应用设置**：`~/.config/service-master/settings.json`

### WebDAV 同步

在"设置"中配置 WebDAV 信息，可实现配置云同步：

1. 填写 WebDAV 服务器地址
2. 填写用户名和密码
3. 点击"测试连接"
4. 使用"上传到 WebDAV"或"从 WebDAV 下载"同步配置

---

## 常见问题

### 服务无法启动

**检查项：**
1. 命令/应用路径是否正确
2. 是否有执行权限
3. 工作目录是否存在
4. 查看错误日志（如果配置了）

**调试方法：**
```bash
# 查看 launchd 日志
log show --predicate 'subsystem == "com.apple.launchd"' --last 10m

# 手动测试命令
cd /path/to/working/directory
/path/to/program arg1 arg2
```

### 端口被占用

如果启动时提示端口被占用：
1. 应用会自动检测并提示
2. 可选择杀死占用进程并启动
3. 或修改服务配置使用其他端口

### macOS 安装问题

**问题：提示"文件已损坏"**

解决方法（任选其一）：

```bash
# 方法1：移除隔离属性
sudo xattr -rd com.apple.quarantine /Applications/ServiceMaster.app

# 方法2：允许任何来源
sudo spctl --master-disable

# 方法3：右键打开
# 右键点击应用 → 打开 → 仍要打开
```

### 服务自动重启

如果不希望服务崩溃后自动重启：
- 取消勾选"崩溃自动重启"选项

### 日志查看

1. 配置服务时填写日志路径
2. 点击服务卡片上的"日志"按钮
3. 日志会自动刷新（每3秒）

清空日志：
- 在日志面板点击"清空"按钮

---

## 高级功能

### 导入/导出配置

在"设置"中：
- **导出配置**：保存所有服务配置为 JSON 文件
- **导入配置**：从 JSON 文件恢复配置

### 主题设置

支持三种主题模式：
- ☀️ **亮色模式**
- 🌙 **暗色模式**
- 🔄 **跟随系统**

可自定义主题色和窗口透明度。

### 自动更新

应用支持自动检查更新：
1. 在"设置"中点击"检查更新"
2. 如有新版本，点击"立即更新"
3. 应用会自动下载并安装更新

---

## 技术说明

### launchd 服务

ServiceMaster 基于 macOS 的 launchd 系统服务管理器：
- 服务配置保存为 `.plist` 文件
- 使用 `launchctl` 命令加载/卸载服务
- 支持开机自启动和自动重启

### 服务状态检测

- **进程检测**：通过 PID 检测服务是否运行
- **端口检测**：检测端口是否被监听
- **健康检查**：定期访问 Web 地址检测服务健康状态

---

## 获取帮助

- **GitHub Issues**: https://github.com/ahao430/mac-service-master/issues
- **GitHub 仓库**: https://github.com/ahao430/mac-service-master

---

**版本**: 0.1.6
**最后更新**: 2026-01-20
